FROM apache/airflow:2.8.0-python3.11

USER airflow
WORKDIR /opt/airflow

RUN pip install --no-cache-dir \
    confluent-kafka>=2.3.0 \
    pydantic>=2.5.0 \
    pydantic-settings>=2.1.0 \
    sqlalchemy>=2.0.0 \
    psycopg2-binary>=2.9.0 \
    alembic>=1.13.0 \
    pandas>=2.1.0

COPY --chown=airflow:root src/ src/
COPY --chown=airflow:root alembic.ini .
COPY --chown=airflow:root migrations/ migrations/

ENV PYTHONPATH="/opt/airflow/src:${PYTHONPATH}"
